---
- name: AI - Update winget sources
  ansible.windows.win_command: winget.exe source update
  register: winget_source_update
  changed_when: "'Updated' in winget_source_update.stdout or 'Updated' in winget_source_update.stderr"
  failed_when: false
  tags: [ai, cursor, antigravity, claude]

- name: AI - Install Cursor
  ansible.windows.win_command: winget install --id Cursor.Cursor --source winget --accept-source-agreements --accept-package-agreements --scope machine
  register: cursor_install
  failed_when: 
    - cursor_install.rc != 0
    - "'No available upgrade found' not in cursor_install.stdout"
    - "'No newer package versions are available' not in cursor_install.stdout"
    - "'No applicable installer found' not in cursor_install.stdout"
    - "'No package found matching input criteria' not in cursor_install.stdout"
  ignore_errors: true
  tags: [ai, cursor]

- name: AI - Install Google Antigravity
  ansible.windows.win_command: winget install --id Google.Antigravity --source winget --accept-source-agreements --accept-package-agreements --scope machine
  register: antigravity_install
  failed_when: 
    - antigravity_install.rc != 0
    - "'No available upgrade found' not in antigravity_install.stdout"
    - "'No newer package versions are available' not in antigravity_install.stdout"
    - "'No applicable installer found' not in antigravity_install.stdout"
    - "'No package found matching input criteria' not in antigravity_install.stdout"
  ignore_errors: true
  tags: [ai, antigravity]

- name: AI - Install Claude Code
  ansible.windows.win_command: winget install --id Anthropic.ClaudeCode --source winget --accept-source-agreements --accept-package-agreements --scope machine
  register: claude_install
  failed_when: 
    - claude_install.rc != 0
    - "'No available upgrade found' not in claude_install.stdout"
    - "'No newer package versions are available' not in claude_install.stdout"
    - "'No applicable installer found' not in claude_install.stdout"
    - "'No package found matching input criteria' not in claude_install.stdout"
  ignore_errors: true
  tags: [ai, claude]
